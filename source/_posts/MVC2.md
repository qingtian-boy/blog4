---
title: MVC2
date: 2019-02-20 17:01:27
tags: PHP
---
# 一、昨日回顾

## 1. 知识回顾

1. 如何引入并配置Smarty？

   1. 将smarty的libs核心类库目录拷贝一份到自己的项目目录中，（选做：将名字修改为指定的名字，比如昨天我们修改为smarty这个名字）

   2. 然后在项目目录中创建一个名为templates的目录，这个目录以后专门存放模板文件；

   3. 最后在程序中引入Smarty3.0核心类文件，代码如下：

      ```php
      include './smarty/Smarty.class.php';
      ```
<!-- more -->
      引入文件后，就可以基于Smarty类来创建对象，

      ```php
      $smarty = new Smarty;
      ```

      

2. 使用assign方法有什么用？

   作用：往模板当中去分配一个指定的模板变量；

3. 使用display方法有什么用？

   作用：可以加载（渲染）一个模板。

4. 在模板中如何展示分配的变量？

   ```html
   <html>
       <body>
           <span>简单模板变量</span>{$title}
           <span>数组模板变量</span>{$arr.name} 或  {$arr['name']}
           <span>对象模板变量</span>非静态属性：{$obj->age}  非静态方法：{$obj->f1()}
       </body>
   </html>
   ```

   

5. 如何指定smarty的模板目录和编译模板目录？

   模板目录的设定：$smarty->setTemplateDir('./view');    (设置之前必须手动创建出该目录)

   编译模板目录的设置：$smarty->setCompileDir('./view_c');



## 3. 知识回顾

什么是MVC？

M： Model模型，负责专门操作数据表的，一般情况下，一个数据表就对应着一个模型文件；

V： View视图（模板），负责专门展示数据；

C： Controller控制器，专门负责调度处理业务逻辑的；比如什么时候该去调用模型操作数据表；什么时候该去调用视图展示数据，都由控制器负责进行调度；
# 二、知识路径

- MVC基本概念

  ​ 为什么使用MVC

  ​ 什么是MVC

  ==目标：能够说出MVC的三大组件==

- 使用新闻管理系统实现MVC

  ​ MVC实现过程

  ​   第一步，搭建MVC基本结构，配置专用虚拟主机域名

  ​   第二步，将HTML模板页面转移进项目目录

  ​   第三步，构建控制器展示视图模板文件

  ​   第四步，实现通过入口文件访问不同的页面

  ​   第五步，构建模型类，实现在控制器中调用模型操作数据表中的数据 

  ​   第六步，实现父类模型

  ​   第七步，引入SMARTY模板引擎

  ​   第八步，实现父类控制器

  ​   第九步，实现配置文件

  ​   第十步，实现初始化文件
  ==目标：能够实现前八部，打造基本的MVC结构==

  

# 三、今日课程内容：MVC

## 1. MVC基本概念

### 为什么使用MVC

MVC是目前应用最广的一种编程方式，本质上，MVC是将代码进行分离，将==显示数据的部分==、==处理业务的部分== 和 ==操作数据的部分== 都独立出来。

 

打个比方，没有使用MVC方式进行开发的项目就好像是一个管理混乱的餐馆，客户点菜（需求），餐厅的经理、服务员、清洁员一起上，然后你一嘴我一嘴的告诉厨师要做什么菜，最后菜出来了，又不管各自的职能都去端菜给客户，极其混乱：

![1530972930761](2.png)

而使用了MVC方式开发的项目就好比是一个管理有序的餐馆，每个人员都知道自己该做什么，调理清晰，执行业务顺畅：

![1530972965070](3)



我们以第二天开发的新闻管理系统为例：

以前的实现方式：

![1536015745391](4)

使用MVC的实现方式：

![1536015759201](5)



使用MVC的好处实在是太多，最主要的方面体现在：

1，  可以实现单入口，增强一个项目中对页面地址的控制能力；

2，  功能和数据分层明确，便于后台人员维护和管理；

3，  极其有利于多人协同开发（前端与后台，后台与后台），各成员之间互不影响；

4，  拥有比较完善的基本结构，多人协同开发也不至于产生混乱。



### 什么是MVC

MVC不是某种语法，而是前辈们经过无数的实践总结而得出来的一种便捷，智慧的设计思想。

 

MVC是三个英文单词的首字母，分别代表三个组件：

**M** --》Model

**V** --》View

**C** --》Controller

 

MVC思想大体上将我们开发的程序分成三个部分（三大组件），并且规定这三个部分：

**Model表示模型层**，负责数据业务规则的处理，凡是跟数据操作有关的内容都属于数据逻辑，只要与SQL指令有关，那么都属于模型（数据逻辑）；

 

**View表示视图层**，负责展示数据，其实就是我们看到的页面，也就是模板template（模板），用来承载数据的容器，通常是HTML文件（显示[HTML]，美化[CSS]和效果[JavaScript]）；

 

**Controller表示控制器**，也叫作模块（Module），负责接受用户请求，并调用相应的模型和视图处理和展示业务，是用来与用户直接接触的脚本代码（浏览器直接提交给PHP的脚本对象），判断用户操作的逻辑性，在需要的时候，他可以调用模型操作数据，也可以调用视图展示页面。



## 2. 使用新闻管理系统实现MVC

### MVC实现过程

#### 第一步，搭建MVC基本结构，配置专用虚拟主机域名

1. 在code目录下创建名为mvc的目录，并且在mvc中打造基本的mvc目录结构，结构如下图所示：

   ![1540952996081](56)

2. 配置一个专属的虚拟主机域名:www.mvc.com 指向code/mvc作为网站根目录，

   打开apache的httpd-vhosts.conf文件，增加虚拟主机的配置

   ![1536028850267](7)

   在hosts文件中增加一个重定向配置：

   ![1536028919273](8)

   重启apache

3. 测试使用www.mvc.com访问mvc下入口文件index.php，测试访问效果：
   index.php的内容如下：

   ![1536029099307](10)

   测试使用浏览器访问页面效果如下：

   ![1536029053325](9)

   能够看到上图所示的效果，说明部署成功。



#### 第二步，将HTML模板页面转移进项目目录

1. 将准备好的后台模板页面复制一份，

   ![1536030533066](11)

   在mvc/app/admin/view目录中创建一个名为news的目录，

   ![1536030621714](12)

   将复制的三个文件粘贴到mvc/app/admin/view/news文件夹下，

   ![1536030654968](13)

2. 将准备好的前台模板页面也复制一份，

   ![1536030745205](14)

   将复制的模板文件粘贴到mvc/app/home/view目录中，

   ![1536030796260](15)



#### 第三步，构建控制器展示视图模板文件

1. 在mvc/app/admin/controller目录下创建一个名为NewsController.class.php的文件，

   ![1540954958699](57)

2. 然后在NewsController.class.php中构建相应的类，同时构建三个方法负责调度展示出三个模板页面，

   ```php
   <?php
   
   namespace admin\controller;//创建一个   全局空间  下的  admin空间   下的  controller空间
   
   class NewsController{
   
       //列表页相关
       public function showList(){ 
           
           include '../view/news/newslist.html';
       }
   
       //添加页相关
       public function showAd(){ 
           
           include '../view/news/newsad.html';
       }
   
       //编辑页相关
       public function showUpd(){ 
           
           include '../view/news/newsupd.html';
       }
   }
   ```

   

3. 最后在NewsController.class.php中构建测试代码，分别展示出三个不同的模板页面，

   展示后台新闻管理系统列表页：

   ![1540955131494](58)

   展示后台新闻管理系统添加表页：

   ![1540955171458](59)

   展示后台新闻管理系统编辑表页：

   ![1540955219613](60)




#### 第四步，实现通过入口文件访问不同的页面

1. 将mvc/app/admin/controller/NewsController.class.php文件中如下图所示的测试代码全部剪切，

   ![1540968944995](61)

2. 将上一步剪切的代码全部粘贴到入口文件mvc/index.php中，同时增加引入控制器类文件的代码，

   ![1540969094253](62)

   访问入口文件index.php，效果为：

   ![1540969179410](63)

   我们发现报错了，所以我们进行进一步的改进，

3. 在入口文件index.php中新增如下图所示的定义常量的代码：

   ![1540970399458](64)
   然后将定义好的常量应用到实际的操作代码中，

   在入口文件index.php中如下图所示将蓝框中的代码改变为红框中的代码：

   ![1540970472355](65)

   在mvc/app/admin/controller/NewsController.class.php中如下图所示将蓝框中的代码改变为红框中的代码：

   ![1540970540889](66)

   再次测试访问效果：

   切换为访问后台新闻管理系统列表页：

   ![1540970617061](67)

   切换为访问后台新闻管理系统新增表页：

   ![1540970658732](68)

   我们发现现在如果要切换页面，则必须要在入口文件中手动的修改访问的方法名，太麻烦了，所以我们考虑吧方法名这个值搞的灵活一些，

4. 在入口文件index.php中构建一个动作参数，将如下图所示蓝框中的代码改变成红框中的代码，

   ![1540971122378](69)

   测试使用效果：

   访问后台新闻管理系统列表页：

   ![1540971217125](70)

   访问后台新闻管理系统新增页：

   ![1540971282300](71)

5. 为了能够将控制器的类名调整灵活，我们进一步对入口文件中的操作进行改进，在入口文件inde.php中增加一个模块参数，代码如下图所示将蓝框中的改为红框中的，

   ![1540971909922](72)

   测试访问效果：

   访问后台新闻管理系统列表页：

   ![1540971962848](73)

6. 为了能够让程序更加智能的识别前台和后台，我们在入口文件中新增一个平台参数，代码如下图所示将蓝框中的代码改变红框中的代码：

   ![1540973265091](74)

   测试访问效果：

   访问后台新闻管理系统添加页：

   ![1540973469799](75)




#### 第五步，构建模型类，实现在控制器中调用模型操作数据表中的数据 

1. 在mvc/app/model目录中创建一个名为NewsModel.class.php的文件，

   ![1540977358695](76)

   在上面构建的模型类文件中创建相应的操作数据表获得多条数据的代码：

   ![1540977412508](77)

2. 在入口文件index.php中引入模型类文件，代码如下：

   ![1540977590488](78)

3. 然后在后台新闻管理系统列表页showList方法（mvc/app/admin/controller/NewsController.class.php）中引入模板操作之前调用模型查询列表页需要回显的数据，

   ![1540977632600](79)

   接着将showList方法中查得的所有数据$datas回显到引入的列表页模板（mvc/app/admin/view/news/newslist.html）当中去，

   ![1540977718473](80)

4. 测试使用效果：

   ![1540977798437](81)

#### 第六步，实现父类模型（基础模型类）

我们发现以后操作news表需要的不仅仅只是一个查询多条数据的方法，以后还需要有查询一条数据，设置（增，删，改）操作的方法，所以，我们接下来先将针对news表的模型完善其应有的操作，

1. 将mvc/app/model/NewsModel.class.php中的所有类成员全部删除，

   ![1541121820981](82)

2. 将day23/code/source/PDOTool.class.php类中的所有成员复制一份，

   ![1541121942827](83)

   将上面复制的代码全部粘贴到mvc/app/model/NewsModel.class.php文件的类中，同时将所有用到PDO类和PDOException类的地方全都加上全局空间，

   ![1541122214393](84)

   测试改进效果：

   重新访问后台新闻管理系统列表页：

   ![1541122280240](85)

   我们当前已经完善了针对news表的操作，它已经具有了连库基本操作，查一条数据，查多条数据，设置（增删改）操作。但是我们进一步分析了解到，以后随着项目的不断扩展，项目中的数据表将会不断增多，而所有的数据表都会具有连库基本操作，查一条数据，查多条数据，设置（增删改）操作，所以，我们接下将所有数据表都具有的公共操作想办法封装到一个公共的类中，然后让操作数据表的模型类全都继承这个父类，那么，以后所有的模型类也就会具有父类所拥有的操作。

3. 在mvc/core目录下创建一个名为Model.class.php的文件，

   ![1541122725358](86)

   然后将mvc/app/model/NewsModel.class.php文件中所有的类成员全部剪切，

   ![1541122985062](88)

   将上面剪切的代码全部粘贴到mvc/core/Model.class.php中，

   ![1541123056672](89)

4. 在入口文件中将父类模型文件引入，

   ![1541123362936](90)

   然后让mvc/app/model/NewsModel.class.php中的NewsModel类去继承父类模型，

   ![1541123437344](91)

   测试使用效果：

   ![1541123520696](92)


#### 第七步，引入SMARTY模板引擎

1. 将如下图所示的准备好的SMARTY核心类库文件夹复制一份，

   ![1541128444946](93)

   将上面复制的目录粘贴到mvc/plugins目录中，并且改名为smarty

   ![1541128496755](94)

2. 然后在入口文件index.php中引入Smarty3.0核心类文件，

   ![1541129675076](95)

3. 在mvc/app/admin/controller/NewsController.class.php里的showList方法中使用SMARTY，如下图所示将蓝框中的代码改为红框中的代码：

   ![1541129765531](96)

   继续将mvc/app/admin/view/news/newslist.html模板页面中展示数据的代码进行调整，如下图所示将蓝框中的代码改为红框中的代码：

   ![1541129861738](97)

4. 测试使用效果：

   ![1541129905328](98)



#### 第八步，实现父类控制器（基础控制器类）

我们在第七步的操作中，发现所有的页面展示时，都要使用SMARTY，不管是前台还是后台都是这样的。而用SAMRTY第一步就必须要 new 一个Smarty类的对象，第二步设置存放模板文件的路径，这些操作要反复大量的写；极其不方便，也不利于后期的维护和二次开发，所以我们需要将这些公共的操作想办法放到一个单独的类中，然后让所有的控制器类都继承这个类，那么这个类中的操作就变成了所有控制器类的公共操作。

1. 在mvc/core目录中创建一个名为Controller.class.php的文件，

   ![1541131019516](99)

   代码如下：

   ![1541131052141](100)

2. 在入口文件中将mvc/core/Controller.class.php的文件引入到程序中，

   ![1541140479267](101)

   然后在控制器类mvc/app/admin/controller/NewsController.class.php中继承父类控制器类Controller,

   ![1541140548829](102)

   测试访问效果：

   ![1541140581137](103)

3. 因为我们发现所有的子类控制器中的展示页面的方法几乎都需要用到SMARTY，而Smarty核心类又没有final关键字，说明可以被别的类所继承，所以我们进一步考虑利用父类控制器Controller来继承Smarty类，进而达到让所有的子类控制器比如NewsController继承Smarty的目的（NewsController继承了Controller类，而Controller类继承了Smarty类），

   ![1541143524696](104)

   然后在父类控制器Controller类中，创建构造方法，对Smarty进行初始化的相关操作，

   ![1541143966994](105)

4. 在mvc/app/admin/controller/NewsController.class.php中的showList方法里调整使用SMARTY的操作，

   ![1541144152190](106)

   测试使用效果：

   访问后台新闻管理系统列表页：

   ![1541144184509](107)

   效果正常。



#### 第九步，实现配置文件

1. 在mvc/config目录下创建一个名为conf.php的文件，代码如下：

   ![1541146399260](108)

2. 在入口文件中引入主配置文件conf.php，

   ![1541146446155](109)

3. 接着在入口文件指定默认访问页面的参数代码中使用上配置文件的默认值，如下图所示将蓝框中的代码改为红框中的代码：

   ![1541146503445](110)

   同时修改mvc/core/Model.class.php中连接数据库的相关参数，如下图所示将蓝框中的代码改为红框中的代码：

   ![1541146596730](111)

4. 测试使用效果：

   ![1541146661068](112)

   效果依然正常。

#### 第十步，实现初始化文件

1. 在mvc/config目录中创建一个名为define的文件，

   ![1541147266690](113)

   将入口文件中所有定义常量的部分全部剪切，粘贴到mvc/config/define.php中，

   ![1541147316002](114)

   粘贴到如下图所示的部分（mvc/config/define.php）：

   ![1541147408910](115)

   接着在入口文件中再引入define.php文件，

   ![1541147461962](116)

   测试访问：

   ![1541147485873](117)

2. 

## 3. 创建核心框架类实现自动加载



# 总结

1. 能够实现基础控制器类（父类控制器）

2. 能够实现基础模型类（父类模型）

3. 能够说出访问框架文件时，地址栏的各个参数都表示什么意思

   xxx.xxx.com/index.php?p=xxx&m=xxx&a=xxx

   p表示平台参数，负责控制比如访问后台还是前台

   m表示模块参数，就是控制器类的类名

   a表示动作参数，就是控制器类中的方法名

4. 能够在当前框架中引入Smarty







