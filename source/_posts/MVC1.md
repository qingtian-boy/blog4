---
title: MVC1
date: 2019-02-20 17:01:24
tags: PHP
---
# 一、昨日回顾

## 1. 知识回顾

1. 如何引入并配置Smarty？

   1. 将smarty的libs核心类库目录拷贝一份到自己的项目目录中，（选做：将名字修改为指定的名字，比如昨天我们修改为smarty这个名字）

   2. 然后在项目目录中创建一个名为templates的目录，这个目录以后专门存放模板文件；
<!-- more -->
   3. 最后在程序中引入Smarty3.0核心类文件，代码如下：

      ```php
      include './smarty/Smarty.class.php';
      ```

      引入文件后，就可以基于Smarty类来创建对象，

      ```php
      $smarty = new Smarty;
      ```

      

2. 使用assign方法有什么用？

   作用：往模板当中去分配一个指定的模板变量；

3. 使用display方法有什么用？

   作用：可以加载（渲染）一个模板。

4. 在模板中如何展示分配的变量？

   ```html
   <html>
       <body>
           <span>简单模板变量</span>{$title}
           <span>数组模板变量</span>{$arr.name} 或  {$arr['name']}
           <span>对象模板变量</span>非静态属性：{$obj->age}  非静态方法：{$obj->f1()}
       </body>
   </html>
   ```

   

5. 如何指定smarty的模板目录和编译模板目录？

   模板目录的设定：$smarty->setTemplateDir('./view');    (设置之前必须手动创建出该目录)

   编译模板目录的设置：$smarty->setCompileDir('./view_c');



# 二、知识路径

- MVC基本概念

  ​ 为什么使用MVC

  ​ 什么是MVC

  ==目标：能够说出MVC的三大组件==

- 使用新闻管理系统实现MVC

  ​ MVC实现过程

  ​   第一步，搭建MVC基本结构，配置专用虚拟主机域名

  ​   第二步，将HTML模板页面转移进项目目录

  ​   第三步，构建控制器展示视图模板文件

  ​   第四步，实现通过入口文件访问不同的页面

  ​   第五步，构建模型类，实现在控制器中调用模型操作数据表中的数据 

  ​   第六步，实现父类模型

  ​   第七步，引入SMARTY模板引擎

  ​   第八步，实现父类控制器

  ​   第九步，实现配置文件

  ​   第十步，实现初始化文件
  ==目标：能够实现前八部，打造基本的MVC结构==

  

# 三、今日课程内容：MVC

## 1. MVC基本概念

### 为什么使用MVC

MVC是目前应用最广的一种编程方式，本质上，MVC是将代码进行分离，将==显示数据的部分==、==处理业务的部分== 和 ==操作数据的部分== 都独立出来。

 

打个比方，没有使用MVC方式进行开发的项目就好像是一个管理混乱的餐馆，客户点菜（需求），餐厅的经理、服务员、清洁员一起上，然后你一嘴我一嘴的告诉厨师要做什么菜，最后菜出来了，又不管各自的职能都去端菜给客户，极其混乱：

![1530972930761](2.png)

而使用了MVC方式开发的项目就好比是一个管理有序的餐馆，每个人员都知道自己该做什么，调理清晰，执行业务顺畅：

![1530972965070](3)



我们以第二天开发的新闻管理系统为例：

以前的实现方式：

![1536015745391](4)

使用MVC的实现方式：

![1536015759201](5)



使用MVC的好处实在是太多，最主要的方面体现在：

1，  可以实现单入口，增强一个项目中对页面地址的控制能力；

2，  功能和数据分层明确，便于后台人员维护和管理；

3，  极其有利于多人协同开发（前端与后台，后台与后台），各成员之间互不影响；

4，  拥有比较完善的基本结构，多人协同开发也不至于产生混乱。



### 什么是MVC

MVC不是某种语法，而是前辈们经过无数的实践总结而得出来的一种便捷，智慧的设计思想。

 

MVC是三个英文单词的首字母，分别代表三个组件：

**M** --》Model

**V** --》View

**C** --》Controller

 

MVC思想大体上将我们开发的程序分成三个部分（三大组件），并且规定这三个部分：

**Model表示模型层**，负责数据业务规则的处理，凡是跟数据操作有关的内容都属于数据逻辑，只要与SQL指令有关，那么都属于模型（数据逻辑）；

 

**View表示视图层**，负责展示数据，其实就是我们看到的页面，也就是模板template（模板），用来承载数据的容器，通常是HTML文件（显示[HTML]，美化[CSS]和效果[JavaScript]）；

 

**Controller表示控制器**，也叫作模块（Module），负责接受用户请求，并调用相应的模型和视图处理和展示业务，是用来与用户直接接触的脚本代码（浏览器直接提交给PHP的脚本对象），判断用户操作的逻辑性，在需要的时候，他可以调用模型操作数据，也可以调用视图展示页面。



## 2. 使用新闻管理系统实现MVC

### MVC实现过程

#### 第一步，搭建MVC基本结构，配置专用虚拟主机域名

1. 在code目录下创建名为mvc的目录，并且在mvc中打造基本的mvc目录结构，结构如下图所示：

   ![1540952996081](56)

2. 配置一个专属的虚拟主机域名:www.mvc.com 指向code/mvc作为网站根目录，

   打开apache的httpd-vhosts.conf文件，增加虚拟主机的配置

   ![1536028850267](7)

   在hosts文件中增加一个重定向配置：

   ![1536028919273](8)

   重启apache

3. 测试使用www.mvc.com访问mvc下入口文件index.php，测试访问效果：
   index.php的内容如下：

   ![1536029099307](10)

   测试使用浏览器访问页面效果如下：

   ![1536029053325](9)

   能够看到上图所示的效果，说明部署成功。



#### 第二步，将HTML模板页面转移进项目目录

1. 将准备好的后台模板页面复制一份，

   ![1536030533066](11)

   在mvc/app/admin/view目录中创建一个名为news的目录，

   ![1536030621714](12)

   将复制的三个文件粘贴到mvc/app/admin/view/news文件夹下，

   ![1536030654968](13)

2. 将准备好的前台模板页面也复制一份，

   ![1536030745205](14)

   将复制的模板文件粘贴到mvc/app/home/view目录中，

   ![1536030796260](15)



#### 第三步，构建控制器展示视图模板文件

1. 在mvc/app/admin/controller目录下创建一个名为NewsController.class.php的文件，

   ![1540954958699](57)

2. 然后在NewsController.class.php中构建相应的类，同时构建三个方法负责调度展示出三个模板页面，

   ```php
   <?php
   
   namespace admin\controller;//创建一个   全局空间  下的  admin空间   下的  controller空间
   
   class NewsController{
   
       //列表页相关
       public function showList(){ 
           
           include '../view/news/newslist.html';
       }
   
       //添加页相关
       public function showAd(){ 
           
           include '../view/news/newsad.html';
       }
   
       //编辑页相关
       public function showUpd(){ 
           
           include '../view/news/newsupd.html';
       }
   }
   ```

   

3. 最后在NewsController.class.php中构建测试代码，分别展示出三个不同的模板页面，

   展示后台新闻管理系统列表页：

   ![1540955131494](58)

   展示后台新闻管理系统添加表页：

   ![1540955171458](59)

   展示后台新闻管理系统编辑表页：

   ![1540955219613](60)




#### 第四步，实现通过入口文件访问不同的页面

1. 将mvc/app/admin/controller/NewsController.class.php文件中如下图所示的测试代码全部剪切，

   ![1540968944995](61)

2. 将上一步剪切的代码全部粘贴到入口文件mvc/index.php中，同时增加引入控制器类文件的代码，

   ![1540969094253](62)

   访问入口文件index.php，效果为：

   ![1540969179410](63)

   我们发现报错了，所以我们进行进一步的改进，

3. 在入口文件index.php中新增如下图所示的定义常量的代码：

   ![1540970399458](64)
   然后将定义好的常量应用到实际的操作代码中，

   在入口文件index.php中如下图所示将蓝框中的代码改变为红框中的代码：

   ![1540970472355](65)

   在mvc/app/admin/controller/NewsController.class.php中如下图所示将蓝框中的代码改变为红框中的代码：

   ![1540970540889](66)

   再次测试访问效果：

   切换为访问后台新闻管理系统列表页：

   ![1540970617061](67)

   切换为访问后台新闻管理系统新增表页：

   ![1540970658732](68)

   我们发现现在如果要切换页面，则必须要在入口文件中手动的修改访问的方法名，太麻烦了，所以我们考虑吧方法名这个值搞的灵活一些，

4. 在入口文件index.php中构建一个动作参数，将如下图所示蓝框中的代码改变成红框中的代码，

   ![1540971122378](69)

   测试使用效果：

   访问后台新闻管理系统列表页：

   ![1540971217125](70)

   访问后台新闻管理系统新增页：

   ![1540971282300](71)

5. 为了能够将控制器的类名调整灵活，我们进一步对入口文件中的操作进行改进，在入口文件inde.php中增加一个模块参数，代码如下图所示将蓝框中的改为红框中的，

   ![1540971909922](72)

   测试访问效果：

   访问后台新闻管理系统列表页：

   ![1540971962848](73)

6. 为了能够让程序更加智能的识别前台和后台，我们在入口文件中新增一个平台参数，代码如下图所示将蓝框中的代码改变红框中的代码：

   ![1540973265091](74)

   测试访问效果：

   访问后台新闻管理系统添加页：

   ![1540973469799](75)




#### 第五步，构建模型类，实现在控制器中调用模型操作数据表中的数据 

1. 在mvc/app/model目录中创建一个名为NewsModel.class.php的文件，

   ![1540977358695](76)

   在上面构建的模型类文件中创建相应的操作数据表获得多条数据的代码：

   ![1540977412508](77)

2. 在入口文件index.php中引入模型类文件，代码如下：

   ![1540977590488](78)

3. 然后在后台新闻管理系统列表页showList方法（mvc/app/admin/controller/NewsController.class.php）中引入模板操作之前调用模型查询列表页需要回显的数据，

   ![1540977632600](79)

   接着将showList方法中查得的所有数据$datas回显到引入的列表页模板（mvc/app/admin/view/news/newslist.html）当中去，

   ![1540977718473](80)

4. 测试使用效果：

   ![1540977798437](81)


#### 第六步，实现父类模型

1. 




#### 第七步，引入SMARTY模板引擎

1. 




#### 第八步，实现父类控制器

1. 



总结：

什么是MVC？

M： model表示模型，专门负责操作数据表的；

V： view表示视图模板，专门负责展示页面数据的；

C： controller表示控制器，专门负责调度逻辑处理程序，比如什么时候该调用模型操作数据表，什么时候该调用视图展示页面数据，都由控制器负责调度。







