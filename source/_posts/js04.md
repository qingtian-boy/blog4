---
title: js04
date: 2019-02-20 14:21:14
tags: JS
---
JavaScript从入门到精通（三）

 

# 一、JS中的函数

## 1、作用域

所谓的作用域就是变量在哪里可用，在哪里不可用，简单来说就是变量的作用范围。

在JavaScript中，变量一共有两种形式：全局变量 + 局部变量。

在JavaScript中，没有块级作用域，我们对作用域的划分都是通过function函数来实现的。在函数外部定义的变量就称之为全局变量。

在函数内部通过var声明的变量就称之为局部变量。

![img](wpsD529.tmp.jpg) 
<!-- more -->
![img](wpsD52A.tmp.jpg) 

## 2、块级作用域

在有些强类型的编程语言中，如C++、Java中，变量的划分都是通过{}花括号来决定的，花括号内部定义的变量就是局部变量，花括号外部定义的变量就是全局变量。

if(判断条件) {

​	声明变量i;  //这个小i就是局部变量

}

//在全局作用域中，是无法直接访问变量小i

但是以上代码在我们的PHP以及JavaScript是不成立的，因为PHP以及JavaScript都属于弱类型语言，没有块级作用域，其对作用域的划分都是通过function函数来实现的。

## 3、变量的访问

① 在全局作用域中可以访问全局变量（成立）

![img](wpsD52B.tmp.jpg) 

② 在局部作用域中可以访问局部变量（成立）

![img](wpsD52C.tmp.jpg) 

③ 在全局作用域中不能直接访问局部变量，因为局部变量在函数执行完毕后已被回收

![img](wpsD52D.tmp.jpg) 

问题：我们明明在display函数中声明了var num=10，但是为什么无法在全局作用域中访问到呢？

答：主要是由于JavaScript中的垃圾回收机制，当一个函数执行完毕后，其内部的变量都会自动被计算机的内存所回收。我们把这种机制就称之为“垃圾回收机制”。

 

④ 在局部作用域中可以访问全局变量（成立）

![img](wpsD52E.tmp.jpg) 

问题：为什么在局部作用域中可以访问全局变量呢？

答：受到作用域链的影响。

## 4、作用域链（难点）

当我们在一个函数中访问一个变量时，系统会自动在当前作用域中去寻找该变量的声明(var)语句，如果找到则直接使用。如果未找到，则继续向上一级作用域中去寻找（不一定是全局），如果找到则直接使用。如果未找到，继续向上一级作用域中去寻找...直到全局作用域，如找到则直接使用，如果还未找到，直接报引用错误。

 

例1：观察以下代码，写出程序的运行结果（不能运行）

![img](wpsD52F.tmp.jpg) 

运行结果：10

原因解析：在JavaScript中代码都是从上往下一行一行执行的，所以首先执行第9行，定义一个全局变量var num = 1，然后继续向下执行，声明函数fn1，然后跳转到20行，调用fn1函数，执行fn1函数内部的代码，执行到第11行，num = 10，引入一个变量num，执行作用域链，系统首先会在fn1函数中寻找var的声明语句，未找到，则继续向上一级作用域中去寻找，找到var num = 1，直接使用，然后把10赋值给全局中的num，var num = 10，然后代码继续向下执行定义fn2，然后执行fn2，在定义fn3，执行fn3，执行到第14行，又引入了变量num，继续执行作用域链，找fn3中是否存在var num的声明语句，未找到，继续到fn2中寻找，未找到，继续到fn1中寻找，未找到，继续到全局作用域中寻找，找到了，var num = 10，所以最终结果为10。

 

例2：观察以下代码，说出程序的运行结果

![img](wpsD530.tmp.jpg) 

运行结果：20,20

作用域链的原理图：

![img](wpsD531.tmp.jpg) 

如上图所示，我们把这种由内向外查询的链式关系，就称之为“作用域链”。

## 5、JS的执行原理（重点难点）

![img](wpsD532.tmp.jpg) 

由上图可知，JS代码要想执行必须通过浏览器引擎（JS解析引擎）。JS在底层执行中一共分为两个阶段：① 编译阶段 ② 执行阶段

① 编译阶段

声明变量、声明函数、语法检查、语义检查、代码优化、生成并得到代码树。

② 执行阶段

变量的赋值、函数的调用以及代码的执行都是发生在这个阶段的。

![img](wpsD533.tmp.jpg) 

 

案例1：var num = 10是如何执行的？

答：一共分为两个阶段，编译阶段 + 执行阶段

编译阶段：声明变量var num = undefined;

执行阶段：变量赋值num = 10;

 

案例2：观察以下代码，说出程序运行的结果

​	console.log(num);  //???

​	var num = 10;

​	console.log(num);  //???

运行结果：undefined，10

原因解析：在JavaScript中，一共有两种作用域：变量作用域 + 词法作用域，变量作用域是在JS代码定义时就可以确定的。词法作用域是发生在浏览器底层JS引擎解析代码时动态生成的，其运行时必须经历编译阶段 + 执行阶段。

![img](wpsD534.tmp.jpg) 

## 6、变量提升与函数提升

① 变量提升：

定义变量的时候，变量的声明会被提升到作用域的最上面，变量的赋值不会提升。

② 函数提升

JavaScript解析器首先会把当前作用域的函数声明提前到整个作用域的最前面。

记住：变量和函数虽然在编译阶段都会被提升到作用域的最顶层，但是函数提升的优先级要高于变量提升的优先级。

 

例1：观察以下代码，说出程序的运行结果

![img](wpsD535.tmp.jpg) 

 

例2：如果函数声明采用var 变量名称 = function() {}的形式，其只有函数名称会被提升

![img](wpsD536.tmp.jpg) 

 

例3：观察以下代码，写出程序的运行结果（面试题）

![img](wpsD537.tmp.jpg) 

如果变量与函数同名，则函数提升在前，变量提升在后。

 

例4：观察一下代码，写出程序的运行结果（面试题）

![img](wpsD538.tmp.jpg) 

运行结果：12

原因解析：在JavaScript中，变量和函数如果同名都会被提升，但是如果变量没有进行赋值操作，则调用函数时，系统会自动调用函数部分而忽略变量。

 

问题：为什么函数与变量同名，其返回的结果会有所不同

![img](wpsD549.tmp.jpg) 

提示：不管是普通变量还是函数，尽量不要出现重名。

 

例5：编译阶段，在函数内部的变量也会自动提升到作用域的最顶层

![img](wpsD54A.tmp.jpg) 

运行结果：undefined，20

原因解析：

![img](wpsD54B.tmp.jpg) 

# 二、浏览器的API

## 1、HTML、CSS、JavaScript

HTML：用来存储网页内容（构建网页结构）；

CSS：用来定义这些内容的显示样式；

JavaScript：用来创造丰富的页面效果或者网页应用。

## 2、浏览器API

API（Application Programming Interface,应用程序编程接口）是一些预先定义的函数，目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节。

## 3、Web API概念

浏览器提供的一套操作浏览器功能和页面元素的API(BOM和DOM)

此处的Web API特指浏览器给JS提供的API(一组方法)，Web API在后面的课程中有其它含义。

# 三、文档的DOM模型

## 1、什么是DOM模型

DOM是JavaScript操作网页的接口，全称为“文档对象模型”(Document Object Model)，它的作用是将网页转为一个JavaScript对象，从而可以用脚本进行各种操作(增删改查)。

## 2、DOM树结构

![img](wpsD54C.tmp.jpg) 

内存原理图：

![img](wpsD54D.tmp.jpg) 

DOM的最小组成单位叫做节点(node)。文档的树形结构(DOM树)，就是由各种不同类型的节点组成。 

每个节点都可以看作是文档树的一片叶子或者一个枝干。

最顶层的节点就是document节点，它代表了整个文档；是文档的根节点。

每张网页都有自己的document节点，window.document属性就指向这个节点的。

只要浏览器开始载入HTML文档，这个节点对象就存在了，可以直接调用。

## 3、节点与节点之间的关系

在DOM树结构中，节点与节点之间存在以下三种关系：

父节点关系(parentNode):直接的那个上级节点 

子节点关系(childNodes):直接的下级节点 

同级节点关系(sibling):拥有同一个父节点的节点

## 4、查找节点（重点中的重点）

① 根据标签的名称获取元素getElementsByTagName()

返回所有指定HTML标签的元素，返回值是一个类似数组的HTMLCollection对象；匹配失败，返回[]
例1：获取页面中的所有p标签

![img](wpsD54E.tmp.jpg)
② 根据标签的class属性名称来获取元素getElementsByClassName()

返回所有class名字符合指定条件的元素,返回值是一个类似数组的HTMLCollection对象；匹配失败，返回[]。

例2：获取页面中所有class=”p”的元素

![img](wpsD54F.tmp.jpg) 

 

③ 根据元素的name属性名称获取元素，getElementsByName()

选择拥有name属性的HTML元素，返回值是一个类似数组的NodeList对象；匹配失败，返回[]

 

例3：获取页面中name=’p’的元素，然后把其内部的文本更改hello world

![img](wpsD550.tmp.jpg) 

 

④ 根据元素的id属性名称获取元素，只返回1个元素getElementById()

返回匹配指定id属性的元素节点;没有发现匹配的节点，则返回null

 

例4：获取id=”p”的元素，然后设置文本内容（包含HTML标签）

![img](wpsD551.tmp.jpg) 

# 四、DOM相关案例（\）

例1：点击按钮显示一张图片

![img](wpsD552.tmp.jpg) 

 

例2：单击按钮，修改p标签的内容

![img](wpsD553.tmp.jpg) 

 

例3：点击按钮更改a标签的热点文字以及超级连接地址

<a href=’deal.php?act=del’>删除</a>

![img](wpsD554.tmp.jpg) 

 

例4：点击按钮，更改所有p标签的内容

![img](wpsD555.tmp.jpg) 

 

例5：点击按钮更改图片的alt以及title属性

扫盲：图片有两个属性，alt以及title

alt属性：当图片无法显示时，系统会自动显示alt的内容

title属性：当鼠标悬浮在图片上方时，系统会自动提示的文本内容

![img](wpsD556.tmp.jpg) 

 

例6：封装一个函数，专门用于获取指定id的DOM对象

在JavaScript中，我们都是通过document.getElementById(id)获取某一个DOM对象的，但是我们发现在一个页面中我们可能会同时获取多次DOM多次，document.getElementById(id)重复代码过多，能不能对其进行简化呢？

![img](wpsD557.tmp.jpg) 

 

例7：单击按钮更改按钮的value值信息

<input type=’button’ id=’btnok’ value=’值’ />

![img](wpsD567.tmp.jpg) 

我们在onclick事件处理程序的内部，我们可以通过$(‘btnok’).value的方式获取自身元素。其实在事件处理程序的内部还可以通过this关键词来调用元素本身。

基本语法：

$(‘btnok’).onclick = function() {

​	//函数的内部还存在一个this关键字，指向$(‘btnok’)本身

}

在函数的内部都存在一个关键字this，this指向哪里呢？

答：记住，谁调用了这个函数，函数内部的this就指向谁。

以上代码还可以改写为如下形式：

![img](wpsD568.tmp.jpg) 